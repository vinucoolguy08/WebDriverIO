{"version":3,"file":"afterScreenshot.js","sourceRoot":"","sources":["../../lib/helpers/afterScreenshot.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,sEAAiE;AACjE,kFAA6E;AAC7E,yCAA0C;AAC1C,iCAAwE;AACxE,4CAAkD;AAClD,6BAA0B;AAG1B,8EAAyE;AACzE,+BAA6B;AAC7B,yDAA6C;AAM7C,SAA8B,eAAe,CAAC,QAAkB,EAAE,OAA+B;;;;;;oBAE7F,YAAY,GAUV,OAAO,aAVG,EACZ,WAAW,GAST,OAAO,YATE,EACX,mBAAmB,GAQjB,OAAO,oBARU,EACT,eAAe,GAOvB,OAAO,SAPgB,EACzB,QAAQ,GAMN,OAAO,SAND,EACR,YAAY,GAKV,OAAO,aALG,EACI,YAAY,GAI1B,OAAO,eAJmB,EAC5B,QAAQ,GAGN,OAAO,SAHD,EACR,YAAY,GAEV,OAAO,aAFG,EACZ,cAAc,GACZ,OAAO,eADK,CACJ;oBAGN,IAAI,GAAG,IAAA,wBAAgB,EAAC,YAAY,EAAE,QAAQ,CAAC,CAAC;oBAGhD,QAAQ,GAAG,IAAA,sBAAc,EAAC,eAAe,CAAC,CAAC;oBAGjD,WAAM,IAAA,wBAAe,EAAC,WAAW,EAAE,IAAA,WAAI,EAAC,IAAI,EAAE,QAAQ,CAAC,CAAC,EAAA;;oBAAxD,SAAwD,CAAC;yBAIrD,YAAY,EAAZ,cAAY;oBACd,WAAM,QAAQ,CAAC,wBAAc,EAAE,CAAC,YAAY,CAAC,EAAA;;oBAA7C,SAA6C,CAAC;;;yBAK5C,CAAA,YAAY,CAAC,MAAM,GAAG,CAAC,IAAI,cAAc,CAAC,MAAM,GAAG,CAAC,CAAA,EAApD,cAAoD;;;;oBAEpD,WAAM,QAAQ,CAAC,4BAAkB,EAAE,EAAC,IAAI,EAAE,YAAY,EAAE,MAAM,EAAE,cAAc,EAAC,EAAE,KAAK,CAAC,EAAA;;oBAAvF,SAAuF,CAAC;;;;oBAExF,IAAG,QAAQ,KAAK,4BAAQ,CAAC,KAAK,IAAI,QAAQ,KAAK,4BAAQ,CAAC,IAAI,EAAE;wBAC5D,OAAO,CAAC,GAAG,CAAC,IAAA,cAAM,EAAC,yOAKjB,GAAC,oIAGV,CAAC,CAAC,CAAC;qBACG;;;yBAMD,CAAA,mBAAmB,IAAI,IAAA,qBAAa,EAAC,YAAY,CAAC,CAAA,EAAlD,cAAkD;oBACpD,WAAM,QAAQ,CAAC,8BAAoB,EAAE,yBAAa,CAAC,EAAA;;oBAAnD,SAAmD,CAAC;;wBAItD,WAAO;wBACL,QAAQ,UAAA;wBACR,IAAI,MAAA;wBACJ,gBAAgB,EAAE,eAAe,CAAC,gBAAgB;qBACnD,EAAC;;;;CACH;AA7DD,kCA6DC","sourcesContent":["import hideScrollBars from '../clientSideScripts/hideScrollbars';\nimport removeElementFromDom from '../clientSideScripts/removeElementFromDom';\nimport {CUSTOM_CSS_ID} from './constants';\nimport {checkIsMobile, formatFileName, getAndCreatePath} from './utils';\nimport {saveBase64Image} from '../methods/images';\nimport {join} from 'path';\nimport {Executor} from '../methods/methods.interface';\nimport {AfterScreenshotOptions, ScreenshotOutput} from './afterScreenshot.interfaces';\nimport hideRemoveElements from '../clientSideScripts/hideRemoveElements';\nimport {yellow} from \"chalk\";\nimport {LogLevel} from \"./options.interface\";\n\n/**\n * Methods that need to be executed after a screenshot has been taken\n * to set all back to the original state\n */\nexport default async function afterScreenshot(executor: Executor, options: AfterScreenshotOptions): Promise<ScreenshotOutput> {\n  const {\n    actualFolder,\n    base64Image,\n    disableCSSAnimation,\n    fileName: fileNameOptions,\n    filePath,\n    hideElements,\n    hideScrollBars: noScrollBars,\n    logLevel,\n    platformName,\n    removeElements,\n  } = options;\n\n  // Get the path\n  const path = getAndCreatePath(actualFolder, filePath);\n\n  // Get the filePath\n  const fileName = formatFileName(fileNameOptions);\n\n  // Save the element\n  await saveBase64Image(base64Image, join(path, fileName));\n\n  // Show the scrollbars again\n  /* istanbul ignore else */\n  if (noScrollBars) {\n    await executor(hideScrollBars, !noScrollBars);\n  }\n\n  // Show elements again\n  /* istanbul ignore else */\n  if (hideElements.length > 0 || removeElements.length > 0) {\n    try {\n      await executor(hideRemoveElements, {hide: hideElements, remove: removeElements}, false);\n    } catch (e) {\n      if(logLevel === LogLevel.debug || logLevel === LogLevel.warn) {\n        console.log(yellow(`\n#####################################################################################\n WARNING:\n (One of) the elements that needed to be hidden or removed could not be found on the\n page and caused this error\n Error: ${e}\n We made sure the test didn't break.\n#####################################################################################\n`));\n      }\n    }\n  }\n\n  // Remove the custom set css\n  /* istanbul ignore else */\n  if (disableCSSAnimation || checkIsMobile(platformName)) {\n    await executor(removeElementFromDom, CUSTOM_CSS_ID);\n  }\n\n  // Return the needed data\n  return {\n    fileName,\n    path,\n    devicePixelRatio: fileNameOptions.devicePixelRatio,\n  };\n}\n"]}